# åç¾æœºåœºè§£æç³»ç»Ÿ

ä¸€ä¸ªç”¨äºè§£æåç¾æœºåœºé“¾æ¥ã€åˆ›å»ºè®¢å•ã€ç”ŸæˆäºŒç»´ç å’ŒåŸå¸‚æ•°æ®ç®¡ç†çš„å®Œæ•´ç³»ç»Ÿã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
backend/
â”œâ”€â”€ src/                    # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ core/              # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ database.js    # æ•°æ®åº“æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ cryptoUtils.js # åŠ å¯†è§£å¯†å·¥å…·
â”‚   â”‚   â””â”€â”€ config.js      # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ cityDataManager.js  # åŸå¸‚æ•°æ®ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ syncCityData.js     # åŸå¸‚æ•°æ®åŒæ­¥æœåŠ¡
â”‚   â”œâ”€â”€ api/               # APIç›¸å…³
â”‚   â”‚   â””â”€â”€ server.js      # ExpressæœåŠ¡å™¨
â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ scheduler.js   # å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨
â”œâ”€â”€ scripts/               # è„šæœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ manage.js          # ç³»ç»Ÿç®¡ç†è„šæœ¬
â”‚   â””â”€â”€ startWithScheduler.js # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ public/                # é™æ€æ–‡ä»¶
â”‚   â”œâ”€â”€ css/              # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ js/               # å‰ç«¯JavaScript
â”‚   â”œâ”€â”€ templates/        # HTMLæ¨¡æ¿
â”‚   â””â”€â”€ simple.html       # ä¸»é¡µé¢
â”œâ”€â”€ data/                  # æ•°æ®æ–‡ä»¶
â”‚   â””â”€â”€ vip_room.db       # SQLiteæ•°æ®åº“
â”œâ”€â”€ logs/                  # æ—¥å¿—æ–‡ä»¶
â”‚   â””â”€â”€ scheduler.log     # å®šæ—¶ä»»åŠ¡æ—¥å¿—
â”œâ”€â”€ index.js              # ä¸»å…¥å£æ–‡ä»¶
â””â”€â”€ package.json          # é¡¹ç›®é…ç½®
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. å¯åŠ¨ç³»ç»Ÿ

```bash
# å¯åŠ¨å®Œæ•´ç³»ç»Ÿï¼ˆæ¨èï¼‰
npm run dev

# æˆ–è€…åªå¯åŠ¨WebæœåŠ¡å™¨
npm start

# æˆ–è€…ä½¿ç”¨ä¸»å…¥å£æ–‡ä»¶
node index.js dev
```

### 3. è®¿é—®ç³»ç»Ÿ

- ä¸»é¡µé¢: <http://localhost:3000/simple.html>
- APIæ–‡æ¡£: <http://localhost:3000/api>

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½

- **é“¾æ¥è§£æ**: è§£æåç¾æœºåœºé“¾æ¥ä¸­çš„åŠ å¯†æ•°æ®
- **è®¢å•åˆ›å»º**: åˆ›å»ºè´µå®¾å…è®¢å•
- **äºŒç»´ç ç”Ÿæˆ**: ç”Ÿæˆä¸“å±äºŒç»´ç 
- **åŠ è§£å¯†å·¥å…·**: AESåŠ å¯†/è§£å¯†åŠŸèƒ½

### åŸå¸‚æ•°æ®ç®¡ç†

- **è‡ªåŠ¨åŒæ­¥**: æ¯å¤©å‡Œæ™¨2ç‚¹è‡ªåŠ¨åŒæ­¥åŸå¸‚æ•°æ®
- **æ‰‹åŠ¨åŒæ­¥**: æ”¯æŒæ‰‹åŠ¨è§¦å‘æ•°æ®åŒæ­¥
- **APIæ¥å£**: æä¾›å®Œæ•´çš„åŸå¸‚æ•°æ®API
- **æ•°æ®å­˜å‚¨**: SQLiteæ•°æ®åº“å­˜å‚¨

### å®šæ—¶ä»»åŠ¡

- **è‡ªåŠ¨è°ƒåº¦**: åŸºäºcronè¡¨è¾¾å¼çš„å®šæ—¶ä»»åŠ¡
- **æ—¥å¿—è®°å½•**: å®Œæ•´çš„æ‰§è¡Œæ—¥å¿—å’Œé”™è¯¯è®°å½•
- **çŠ¶æ€ç›‘æ§**: å®æ—¶æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€
- **ä¼˜é›…å…³é—­**: æ”¯æŒä¼˜é›…çš„è¿›ç¨‹å…³é—­

## ğŸ› ï¸ ç®¡ç†å‘½ä»¤

### ä½¿ç”¨ç®¡ç†è„šæœ¬

```bash
# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤
node scripts/manage.js help

# æ‰‹åŠ¨åŒæ­¥åŸå¸‚æ•°æ®
node scripts/manage.js sync

# æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
node scripts/manage.js status

# æŸ¥çœ‹æ—¥å¿—
node scripts/manage.js logs

# æ¸…ç†æ—¥å¿—
node scripts/manage.js clean
```

### ä½¿ç”¨ä¸»å…¥å£æ–‡ä»¶

```bash
# å¯åŠ¨å®Œæ•´ç³»ç»Ÿ
node index.js dev

# å¯åŠ¨WebæœåŠ¡å™¨
node index.js start

# æ‰‹åŠ¨åŒæ­¥æ•°æ®
node index.js sync

# ä½¿ç”¨ç®¡ç†å·¥å…·
node index.js manage status
```

### ä½¿ç”¨npmè„šæœ¬

```bash
# å¯åŠ¨å®Œæ•´ç³»ç»Ÿ
npm run dev

# å¯åŠ¨WebæœåŠ¡å™¨
npm start

# æ‰‹åŠ¨åŒæ­¥åŸå¸‚æ•°æ®
npm run sync-cities

# å¯åŠ¨å®šæ—¶ä»»åŠ¡
npm run scheduler

# æŸ¥çœ‹å®šæ—¶ä»»åŠ¡çŠ¶æ€
npm run scheduler-status

# åœæ­¢å®šæ—¶ä»»åŠ¡
npm run scheduler-stop
```

## ğŸ”§ APIæ¥å£

### åŸå¸‚æ•°æ®API

- `GET /api/cities` - è·å–æ‰€æœ‰åŸå¸‚æ•°æ®
- `GET /api/cities/country/:countryCode` - æ ¹æ®å›½å®¶è·å–åŸå¸‚
- `GET /api/cities/search?keyword=å…³é”®è¯` - æœç´¢åŸå¸‚
- `POST /api/cities/sync` - æ‰‹åŠ¨åŒæ­¥åŸå¸‚æ•°æ®
- `GET /api/cities/sync-logs` - è·å–åŒæ­¥æ—¥å¿—

### å…¶ä»–API

- `GET /api/vip-room` - è·å–è´µå®¾å…æ•°æ®
- `POST /api/create-order` - åˆ›å»ºè®¢å•
- `GET /api/user-by-order/:orderNo` - æ ¹æ®è®¢å•å·æŸ¥è¯¢ç”¨æˆ·
- `GET /api/all-users` - è·å–æ‰€æœ‰ç”¨æˆ·æ•°æ®

## âš™ï¸ é…ç½®è¯´æ˜

### å®šæ—¶ä»»åŠ¡é…ç½®

- **æ‰§è¡Œæ—¶é—´**: æ¯å¤©å‡Œæ™¨2ç‚¹
- **æ—¶åŒº**: Asia/Shanghai
- **æ—¥å¿—æ–‡ä»¶**: logs/scheduler.log

### æ•°æ®åº“é…ç½®

- **ç±»å‹**: SQLite
- **ä½ç½®**: data/vip_room.db
- **è¡¨ç»“æ„**:
  - `user_data` - ç”¨æˆ·æ•°æ®
  - `cities` - åŸå¸‚æ•°æ®
  - `city_sync_log` - åŒæ­¥æ—¥å¿—

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—æ–‡ä»¶

- `logs/scheduler.log` - å®šæ—¶ä»»åŠ¡æ—¥å¿—
- `server.log` - æœåŠ¡å™¨æ—¥å¿—

### çŠ¶æ€ç›‘æ§

```bash
# æŸ¥çœ‹å®šæ—¶ä»»åŠ¡çŠ¶æ€
node scripts/manage.js status

# æŸ¥çœ‹æ—¥å¿—
node scripts/manage.js logs
```

## ğŸ”„ æ•°æ®åŒæ­¥

### è‡ªåŠ¨åŒæ­¥

ç³»ç»Ÿæ¯å¤©å‡Œæ™¨2ç‚¹è‡ªåŠ¨ä»APIè·å–æœ€æ–°çš„åŸå¸‚æ•°æ®å¹¶å­˜å‚¨åˆ°æ•°æ®åº“ã€‚

### æ‰‹åŠ¨åŒæ­¥

```bash
# ä½¿ç”¨ç®¡ç†è„šæœ¬
node scripts/manage.js sync

# ä½¿ç”¨npmè„šæœ¬
npm run sync-cities

# ä½¿ç”¨ä¸»å…¥å£
node index.js sync
```

### APIåŒæ­¥

```bash
curl -X POST http://localhost:3000/api/cities/sync
```

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†

ç³»ç»ŸåŒ…å«å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š

- ç½‘ç»œè¯·æ±‚å¤±è´¥é‡è¯•
- æ•°æ®åº“æ“ä½œäº‹åŠ¡ä¿æŠ¤
- å®šæ—¶ä»»åŠ¡å¼‚å¸¸æ¢å¤
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•

## ğŸ“ å¼€å‘è¯´æ˜

### æ·»åŠ æ–°åŠŸèƒ½

1. åœ¨ `src/` ç›®å½•ä¸‹åˆ›å»ºç›¸åº”çš„æ¨¡å—
2. æ›´æ–° `src/api/server.js` æ·»åŠ APIè·¯ç”±
3. æ›´æ–° `scripts/manage.js` æ·»åŠ ç®¡ç†å‘½ä»¤
4. æ›´æ–°æ–‡æ¡£

### è°ƒè¯•æ¨¡å¼

```bash
# å¯åŠ¨è°ƒè¯•æ¨¡å¼
DEBUG=* npm run dev

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
node scripts/manage.js logs
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚
